"use strict";function getDataSource(n){var t=[];return $(n).find(".autocomplete-datasource").find(".autocomplete-datasource-item").each(function(n,i){t.push($(i).attr("autocomplete-datasource-item"))}),t}function autocompleteInit(){$(".autocomplete").each(function(){var n=getDataSource(this);autocomplete($(this).find("input")[0],n)});$(document).find(".autocomplete-datasource").remove();document.addEventListener("click",function(n){var i,t,r;if(!n.target.parentNode.classList.contains("autocomplete")&&!n.target.parentNode.classList.contains("autocomplete-items")){for(i=document.getElementsByClassName("autocomplete-items"),t=0;t<i.length;t++)i[t].parentNode.removeChild(i[t]);/MSIE|Trident/.test(window.navigator.userAgent)&&focusedACId&&(r=document.getElementById(focusedACId),r.value==="請選擇"&&(r.value="",focusedACId=""))}})}function autocomplete(n,t){function f(n,f){var h,e,s,c=f.value;for(/MSIE|Trident/.test(window.navigator.userAgent)&&$(n).attr("select-like")&&(n.value||(focusedACId=n.id,n.value="請選擇")),$(n).attr("apiurl")&&(t=o(n)),i=-1,h=document.createElement("DIV"),h.setAttribute("id",f.id+"autocomplete-list"),h.setAttribute("class","autocomplete-items"),f.parentNode.appendChild(h),s=0;s<t.length;s++)t[s].substr(0,c.length).toUpperCase()==c.toUpperCase()&&(e=document.createElement("DIV"),e.innerHTML="<strong>"+t[s].substr(0,c.length)+"<\/strong>",e.innerHTML+=t[s].substr(c.length),e.innerHTML+="<input type='hidden' value='"+t[s]+"'>",e.addEventListener("mouseover",function(){i=$(this).index();r($(this).parent().children().get())}),e.addEventListener("click",function(){n.value=this.getElementsByTagName("input")[0].value;$(n).change();u(this)}),h.appendChild(e))}function r(n){if(!n)return!1;e(n);i>=n.length&&(i=0);i<0&&(i=n.length-1);n[i].classList.add("autocomplete-active")}function e(n){for(var t=0;t<n.length;t++)n[t].classList.remove("autocomplete-active")}function u(t){for(var r=document.getElementsByClassName("autocomplete-items"),i=0;i<r.length;i++)t!=r[i]&&t!=n&&r[i].parentNode.removeChild(r[i])}function o(n){var t=[];return $.ajax({"async":!1,method:"get",url:$(n).attr("apiurl")+"?"+$(n).attr("paramkey")+"="+$(n).val(),success:function(n){t=JSON.parse(JSON.stringify(n))},error:function(n,t,i){console.log(i)}}),t}t=t||[];var i;n.addEventListener("input",function(){if(u(),this.value.length<1)return!1;f(n,this)});n.addEventListener("keydown",function(n){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div"));n.keyCode==40?(i++,r(t)):n.keyCode==38?(i--,r(t)):n.keyCode==13&&(n.preventDefault(),i>-1&&t&&t[i].click())});$(n).attr("select-like")&&n.addEventListener("click",function(){u();f(n,this)})}var focusedACId="";$(function(){autocompleteInit()});